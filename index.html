<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#d6001c" />
  <title>Facture Delicella</title>

  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@700;800;900&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://npmcdn.com/flatpickr/dist/l10n/fr.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{ --primary:#d6001c; --gold:#cfb04a; --dark:#1e293b; --bg:#fff1f1; }
    *{ box-sizing:border-box; }
    html,body{ height:100%; -webkit-overflow-scrolling: touch; }
    body{
      font-family:'Nunito',sans-serif;
      background:#555;
      padding:20px;
      padding-left:350px;
      padding-bottom: calc(20px + env(safe-area-inset-bottom));
      display:flex;
      justify-content:center;
      -webkit-text-size-adjust:100%;
    }
    input,select,textarea{ font-size:16px; } /* iOS zoom fix */

    /* ============ SIDEBAR ============ */
    .sidebar{
      position:fixed;
      top:20px; left:20px;
      width:300px;
      z-index:999;
      display:flex;
      flex-direction:column;
      gap:24px;
      padding-bottom:12px;
      opacity:0;
      transform:translateX(-10px);
      animation: sideIn .55s cubic-bezier(.2,.9,.2,1) forwards;
    }
    @keyframes sideIn{ to{opacity:1; transform:translateX(0);} }

    .panel{
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.20);
      border-radius: 18px;
      padding: 14px;
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 22px rgba(0,0,0,0.22);
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .btn{
      height:46px; width:100%;
      padding:0 16px;
      border:none;
      border-radius:16px;
      font-weight:900;
      cursor:pointer;
      font-family:'Lexend';
      white-space:nowrap;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      box-shadow:0 12px 26px rgba(0,0,0,0.20);
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
      touch-action: manipulation;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow:0 16px 34px rgba(0,0,0,0.26); filter:brightness(1.03); }

    .btn-clients{ background:#111827; color:#fff; }
    .btn-saveinfo{ background:var(--gold); color:#1e293b; }
    .btn-add{ background:var(--gold); color:#1e293b; }
    .btn-pdf{ background:var(--primary); color:#fff; }
    .btn-print{ background:#0f172a; color:#fff; }

    /* ============ TVA/DEVISE ============ */
    .currency-wrap{ position:relative; width:100%; height:46px; }
    .currency-fab{
      width:100%; height:46px;
      border-radius:14px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 12px 26px rgba(0,0,0,0.22);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 14px;
      cursor:pointer;
      user-select:none;
    }
    .fab-top{
      display:flex; align-items:center; gap:10px;
      font-family:'Lexend'; font-weight:900; font-size:.72rem;
      letter-spacing:1px; color:#64748b; text-transform:uppercase;
    }
    .fab-dot{ width:10px; height:10px; border-radius:50%; background:var(--primary); box-shadow:0 0 0 4px rgba(214,0,28,0.12); }
    .fab-bottom{ font-family:'Lexend'; font-weight:900; font-size:.85rem; color:#0f172a; }

    .currency-menu{
      position:absolute;
      left: calc(100% + 12px);
      top: 0;
      width: 230px;
      background: rgba(255,255,255,0.96);
      border: 1px solid rgba(148,163,184,0.35);
      border-radius: 18px;
      box-shadow: 0 22px 60px rgba(0,0,0,0.30);
      backdrop-filter: blur(14px);
      padding: 12px;
      display: grid;
      grid-template-columns: 1fr 80px;
      gap: 10px;
      align-items: center;
      opacity: 0;
      transform: translateX(-6px);
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 1200;
    }
    .currency-wrap:hover .currency-menu{ opacity:1; transform:translateX(0); pointer-events:auto; }
    .currency-wrap.open .currency-menu{ opacity:1; transform:translateX(0); pointer-events:auto; }

    .currency-menu select, .currency-menu input{
      height:40px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,0.12);
      padding:0 12px;
      font-weight:900;
      outline:none;
      background: rgba(255,255,255,0.98);
    }
    .currency-menu input{ text-align:center; }

    /* ============ A4 ============ */
    .page-a4{
      width: 210mm;
      min-height: 297mm;
      background: white;
      position: relative;
      display:flex;
      flex-direction:column;
      box-shadow: 0 10px 30px rgba(0,0,0,0.30);
      overflow:hidden;
      z-index: 1;
    }

    .watermark-container{
      position:absolute; inset:0;
      display:flex; justify-content:center; align-items:center;
      z-index:0; opacity:0.08; pointer-events:none;
    }
    .watermark-container img{ width:75%; height:auto; }

    .header, .body, .footer{ position:relative; z-index:2; }

    .header{
      background: rgba(255, 241, 241, 0.85);
      padding: 21px 40px 10px 40px;
      border-bottom: 4px solid var(--gold);
      display:flex; justify-content:space-between; align-items:flex-start;
    }
    .title{
      font-family:'Lexend';
      font-size:4.2rem;
      color: var(--primary);
      margin:0;
      line-height:1;
      text-transform:uppercase;
      letter-spacing:2px;
      margin-left:20px;
    }
    .meta{ margin-top:40px; display:flex; flex-direction:column; gap:10px; }
    .meta-row{ display:flex; align-items:center; gap:10px; font-weight:800; color:var(--dark); }
    .meta-row span{ color:var(--primary); font-family:'Lexend'; font-size:0.9rem; }
    .meta-row input{
      background:transparent;
      border:none;
      font-weight:800;
      font-size:1.1rem;
      color:var(--dark);
      width:140px;
      cursor:pointer;
      outline:none;
    }
    .logo-box img{ height:250px; width:auto; margin-top:-50px; }

    .body{ padding:25px 40px; flex:1; display:flex; flex-direction:column; }

    .grid{ display:grid; grid-template-columns:0.6fr 1.4fr; gap:0; margin-bottom:35px; }
    .grid > div:first-child{ border-right:3px solid var(--gold); padding-right:25px; }
    .client-section{ padding-left:25px; }

    .box-title{
      color:#000;
      font-size:.85rem;
      font-weight:800;
      display:inline-block;
      padding-bottom:6px;
      margin-bottom:15px;
      text-transform:uppercase;
      letter-spacing:1px;
      line-height:1;
      box-shadow: inset 0 -3px 0 var(--primary);
    }
    .company-info{ font-size:.95rem; line-height:1.5; color:var(--dark); }

    .input-group{ display:flex; align-items:flex-start; margin-bottom:8px; border-bottom:1px dashed #ccc; padding-bottom:2px; }
    .input-group label{
      font-weight:700; color:var(--dark); font-size:.85rem;
      min-width:145px; font-family:'Lexend'; padding-top:5px; text-transform:uppercase;
    }
    .input-group input{ flex:1; border:none; background:transparent; font-weight:600; font-size:.95rem; color:#000; padding:5px 0 5px 10px; outline:none; }

    .flow-box{ border-bottom:1px dashed #ccc; margin-bottom:8px; padding-bottom:5px; cursor:text; display:block; }
    .flow-box label{ font-weight:700; color:var(--dark); font-size:.85rem; font-family:'Lexend'; text-transform:uppercase; display:inline; margin-right:5px; }
    .flow-content{ display:inline; font-weight:600; font-size:.95rem; color:#000; outline:none; word-break:break-word; }
    .flow-content:empty:before{ content:'...'; color:#aaa; font-weight:400; }

    .phone-wrapper{ display:flex; align-items:center; flex:1; }
    .phone-select{ border:none; background:transparent; font-weight:800; font-size:.9rem; color:var(--primary); cursor:pointer; margin-right:8px; outline:none; }
    .phone-input{ flex:1; border:none; background:transparent; font-weight:600; font-size:.95rem; color:#000; outline:none; padding:5px 0 5px 10px; }

    table{ width:100%; border-collapse:collapse; margin-top:10px; }
    th{ text-align:left; padding:8px 5px; color:var(--primary); font-family:'Lexend'; font-size:.85rem; }
    thead{ position:relative; }
    thead::after{ content:""; position:absolute; left:0; right:0; bottom:0; height:2px; background:var(--primary); }
    td{ padding:8px 5px; border-bottom:1px solid #f0f0f0; }
    td input{ width:100%; border:none; font-weight:700; font-size:.95rem; background:transparent; outline:none; }

    .delete-btn{
      background:transparent; border:none; cursor:pointer;
      color:var(--primary); font-weight:900; font-size:1.1rem;
      padding:2px 6px; border-radius:6px; line-height:1;
    }

    .totals-section{ display:flex; justify-content:flex-end; margin-top:30px; }
    .totals-box{ width:240px; background:transparent; padding:10px; border-radius:8px; border:1px solid rgba(0,0,0,0.05); }
    .row{ display:flex; justify-content:space-between; padding:6px 0; font-weight:700; color:#64748b; font-size:.9rem; }
    .row.final{ color:var(--primary); font-size:1.1rem; border-top:2px solid var(--primary); margin-top:5px; padding-top:5px; font-family:'Lexend'; }

    .payment-section{ margin-top:40px; display:flex; justify-content:flex-start; }
    .payment-box{ font-size:.9rem; color:var(--dark); background:rgba(255,241,241,0.4); padding:15px; border-radius:8px; border-left:3px solid var(--gold); min-width:300px; }
    .payment-title{ font-family:'Lexend'; font-weight:800; color:var(--primary); text-transform:uppercase; margin-bottom:5px; font-size:.95rem; display:inline-block; border-bottom:2px solid var(--gold); padding-bottom:2px; }
    .payment-details{ line-height:1.6; margin-top:5px; }
    .bank-info{ font-weight:800; color:#000; font-size:1rem; }

    .footer{ padding:15px 40px; border-top:2px solid var(--gold); font-size:.75rem; color:#94a3b8; display:flex; justify-content:space-between; font-weight:700; margin-top:auto; }

    .no-print{ display:block; }

    /* ============ MOBILE ============ */
    @media (max-width:980px){
      body{ display:block; padding:14px !important; padding-left:14px !important; background:#f1f5f9; }
      .sidebar{
        position:sticky;
        top: calc(12px + env(safe-area-inset-top));
        width:100%;
        max-width:560px;
        margin:0 auto 14px auto;
        transform:none;
        z-index:20;
      }
      .currency-menu{ left:0; top:56px; width:100%; }
      .page-a4{
        width: calc(100vw - 28px);
        max-width: 210mm;
        height:auto !important;
        min-height: unset !important;
        margin: 0 auto;
        border-radius: 14px;
      }
      .header{ padding:18px 18px 10px 18px; }
      .body{ padding:18px; }
      .logo-box img{ height:150px; margin-top:-20px; }
      .title{ font-size:3rem; margin-left:10px; }
      .meta{ margin-top:18px; }
      .grid{ grid-template-columns:1fr; }
      .grid > div:first-child{ border-right:none; padding-right:0; border-bottom:3px solid var(--gold); padding-bottom:14px; }
      .client-section{ padding-left:0; padding-top:14px; }
      .payment-box{ min-width:100%; }
      .footer{ padding:12px 18px; flex-direction:column; gap:6px; }
      .totals-box{ width:100%; }
      .totals-section{ justify-content:stretch; }
    }
    @media (pointer:coarse){
      body{ display:block; padding:14px !important; padding-left:14px !important; }
    }

    /* ======================================================
       ‚úÖ PRINT FIX (ÿ≠ŸÑ ÿßŸÑŸàÿ±ŸÇÿ© ÿßŸÑÿ®Ÿäÿ∂ÿßÿ°)
       ====================================================== */
    @media print{
      @page { size: A4; margin: 0; }

      *{
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        filter:none !important;
        backdrop-filter:none !important;
        box-shadow:none !important;
        animation:none !important;
        transform:none !important;
      }

      html, body{
        background:#fff !important;
        margin:0 !important;
        padding:0 !important;
        width:210mm !important;
        height:auto !important;
        overflow: visible !important;
      }

      /* ÿÆÿ®Ÿä ŸÉŸÑÿ¥Ÿä */
      body > * { display:none !important; }

      /* ÿÆŸÑŸä ÿ∫Ÿäÿ± ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© */
      #invoice{
        display:block !important;
        position: static !important;
        width:210mm !important;
        min-height:297mm !important;
        height:auto !important;
        overflow: visible !important;
        margin:0 !important;
      }

      .page-a4{
        width:210mm !important;
        min-height:297mm !important;
        height:auto !important;
        overflow: visible !important;
        box-shadow:none !important;
        border-radius:0 !important;
      }

      /* hide ui inside invoice */
      .no-print{ display:none !important; }
    }
  </style>
</head>

<body>
  <div class="sidebar no-print">
    <div class="panel">
      <button class="btn btn-clients" id="openClients">
        <i class="fa-solid fa-users"></i>
        Clients Enregistr√©s
      </button>

      <button class="btn btn-saveinfo" id="saveClient">
        <i class="fa-solid fa-floppy-disk"></i>
        Sauvegarder Info
      </button>
    </div>

    <div class="currency-wrap" id="currencyWrap">
      <div class="currency-fab" id="currencyFab" title="Devise & TVA">
        <div class="fab-top">
          <span class="fab-dot"></span>
          <span>TVA / DEVISE</span>
        </div>
        <div class="fab-bottom">
          <span id="curPreview">MAD</span> ‚Ä¢ <span id="tvaPreview">20%</span>
        </div>
      </div>

      <div class="currency-menu" id="currencyMenu">
        <select id="currency" onchange="calc(); updatePreview()">
          <option value="MAD" selected>MAD</option>
          <option value="EUR">EUR</option>
          <option value="USD">USD</option>
        </select>
        <input id="tvaRate" type="number" value="20" min="0" step="0.1" oninput="calc(); updatePreview()" />
      </div>
    </div>

    <div class="panel">
      <button class="btn btn-add" onclick="addLine()">
        <i class="fa-solid fa-plus"></i>
        Ajouter Ligne
      </button>

      <button class="btn btn-pdf btn-pdf-main" onclick="downloadPDF()">
        <i class="fa-solid fa-file-pdf"></i>
        T√©l√©charger PDF
      </button>

      <!-- ‚úÖ ÿ≤ÿ± ÿßŸÑÿ∑ÿ®ÿßÿπÿ© -->
      <button class="btn btn-print" onclick="doPrint()">
        <i class="fa-solid fa-print"></i>
        Imprimer
      </button>
    </div>
  </div>

  <div class="page-a4" id="invoice">
    <div class="watermark-container">
      <img src="data:image/png;base64,....(CODE-WATERMARK-HNA)...." alt="Watermark">
    </div>

    <div class="header">
      <div class="header-left">
        <h1 class="title">FACTURE</h1>
        <div class="meta">
          <div class="meta-row"><span>DATE:</span> <input type="text" id="date" placeholder="S√©lectionner..."></div>
          <div class="meta-row"><span>N¬∞ FACTURE:</span> <input type="text" id="invoiceNum"></div>
        </div>
      </div>
      <div class="logo-box">
        <img src="data:image/png;base64,....(CODE-LOGO-HNA)...." alt="Logo">
      </div>
    </div>

    <div class="body">
      <div class="grid">
        <div>
          <span class="box-title">√âMETTEUR</span>
          <div class="company-info">
            <strong style="color:var(--primary); font-family:'Lexend'; font-size:1.1rem;">DELICELLA SARL AU</strong><br>
            4, Rue Oued Ziz, 3√®me √âtage<br>Appt. 7, Agdal<br>
            +212 642-395388
          </div>
        </div>

        <div class="client-section">
          <span class="box-title">DESTINATAIRE</span>

          <div class="input-group">
            <label>Nom du client :</label>
            <input type="text" id="c_name" placeholder="...">
          </div>

          <div class="flow-box" onclick="this.querySelector('.flow-content').focus()">
            <label>Soci√©t√© Nom :</label>
            <span class="flow-content" id="c_company" contenteditable="true"></span>
          </div>

          <div class="flow-box" onclick="this.querySelector('.flow-content').focus()">
            <label>ICE :</label>
            <span class="flow-content" id="c_ice" contenteditable="true"></span>
          </div>

          <div class="flow-box" onclick="this.querySelector('.flow-content').focus()">
            <label>Adresse :</label>
            <span class="flow-content" id="c_address" contenteditable="true"></span>
          </div>

          <div class="input-group">
            <label>N¬∞ T√©l√©phone :</label>
            <div class="phone-wrapper">
              <select class="phone-select" id="c_phone_code">
                <option value="+212">üá≤üá¶ +212</option>
                <option value="+33">üá´üá∑ +33</option>
                <option value="+1">üá∫üá∏ +1</option>
                <option value="+34">üá™üá∏ +34</option>
                <option value="+971">üá¶üá™ +971</option>
              </select>
              <input class="phone-input" type="text" id="c_phone" placeholder="6 00 00 00 00">
            </div>
          </div>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th width="45%">D√âSIGNATION</th>
            <th width="10%" style="text-align:center">QT√â</th>
            <th width="15%" style="text-align:right">P.U</th>
            <th width="20%" style="text-align:right">TOTAL</th>
            <th width="10%" class="no-print"></th>
          </tr>
        </thead>
        <tbody id="lines"></tbody>
      </table>

      <div class="totals-section">
        <div class="totals-box">
          <div class="row"><span>TOTAL HT</span> <span id="tht">0.00</span></div>
          <div class="row"><span id="tvaLabel">TVA (20%)</span> <span id="tva">0.00</span></div>
          <div class="row final"><span>TOTAL TTC</span> <span id="ttc">0.00</span></div>
        </div>
      </div>

      <div class="payment-section">
        <div class="payment-box">
          <div class="payment-title">R√àGLEMENT :</div>
          <div style="margin-bottom:5px; font-size:0.8rem; font-weight:700;">Par virement bancaire :</div>
          <div class="payment-details">
            <div style="margin-bottom:4px;">Banque : <span class="bank-info" contenteditable="true">BMCE BANK</span></div>
            <div>RIB : <span class="bank-info" contenteditable="true">MA64 0118 1500 0011 2100 0094 4504</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div>ICE: 003709007000096 | RC: 185955</div>
      <div>E-mail : contact@delicella.ma</div>
    </div>
  </div>

  <datalist id="produits-list">
    <option value="SAHARA DELICE 700G">
    <option value="SAHARA DELICE 350G">
  </datalist>

  <script>
    const currencySymbols = { MAD:"DH", EUR:"‚Ç¨", USD:"$" };

    window.onload = () => {
      flatpickr("#date", { locale:"fr", dateFormat:"d/m/Y", defaultDate:"today", animate:true, disableMobile:true });
      document.getElementById('invoiceNum').value = Math.floor(10000 + Math.random() * 90000);

      addLine(); addLine();
      updatePreview();
      calc();
      setupCurrencyToggle();
    };

    function isMobile(){ return window.matchMedia("(max-width: 980px)").matches; }

    function setupCurrencyToggle(){
      const wrap = document.getElementById("currencyWrap");
      const fab  = document.getElementById("currencyFab");
      const menu = document.getElementById("currencyMenu");

      fab.addEventListener("click", (e) => {
        if(!isMobile()) return;
        e.stopPropagation();
        wrap.classList.toggle("open");
      });

      menu.addEventListener("click", (e) => e.stopPropagation());

      document.addEventListener("click", (e) => {
        if(!isMobile()) return;
        if(!wrap.contains(e.target)) wrap.classList.remove("open");
      }, { passive:true });

      window.addEventListener("scroll", () => {
        if(isMobile()) wrap.classList.remove("open");
      }, { passive:true });
    }

    function updatePreview(){
      const cur = document.getElementById("currency").value || "MAD";
      const tva = parseFloat(document.getElementById("tvaRate").value);
      document.getElementById("curPreview").innerText = cur;
      document.getElementById("tvaPreview").innerText = (isNaN(tva) ? 20 : tva) + "%";
    }

    function getCurrencySymbol(){
      const cur = document.getElementById('currency')?.value || "MAD";
      return currencySymbols[cur] || "DH";
    }
    function getTvaRate(){
      const v = parseFloat(document.getElementById('tvaRate')?.value);
      return isNaN(v) ? 20 : v;
    }

    function addLine(){
      const sym = getCurrencySymbol();
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" list="produits-list" placeholder="Article ou Service..."></td>
        <td><input class="qty" type="number" value="1" style="text-align:center" oninput="calc()"></td>
        <td><input class="pu" type="number" placeholder="0.00" style="text-align:right" oninput="calc()"></td>
        <td style="text-align:right; font-weight:800; color:#1e293b">0.00 ${sym}</td>
        <td class="no-print" style="text-align:right;">
          <button class="delete-btn" type="button" onclick="removeLine(this)" title="Supprimer">‚úñ</button>
        </td>
      `;
      document.getElementById('lines').appendChild(tr);
      calc();
    }

    function removeLine(btn){
      const row = btn.closest('tr');
      if(row) row.remove();
      calc();
    }

    function calc(){
      const sym  = getCurrencySymbol();
      const rate = getTvaRate();
      document.getElementById('tvaLabel').innerText = `TVA (${rate}%)`;

      let total = 0;
      document.querySelectorAll('#lines tr').forEach(row => {
        const q = parseFloat(row.querySelector('.qty')?.value) || 0;
        const p = parseFloat(row.querySelector('.pu')?.value) || 0;
        const t = q * p;
        row.cells[3].innerText = t.toFixed(2) + " " + sym;
        total += t;
      });

      const tva = total * (rate / 100);
      const ttc = total + tva;

      document.getElementById('tht').innerText = total.toFixed(2) + " " + sym;
      document.getElementById('tva').innerText = tva.toFixed(2) + " " + sym;
      document.getElementById('ttc').innerText = ttc.toFixed(2) + " " + sym;
    }

    /* ‚úÖ PDF stable */
    async function downloadPDF(){
      const invoice = document.getElementById('invoice');
      const btn = document.querySelector('.btn-pdf-main');
      const oldHTML = btn.innerHTML;

      btn.innerHTML = "‚è≥ G√©n√©ration...";
      btn.disabled = true;

      const oldScroll = window.scrollY || 0;
      window.scrollTo(0,0);

      const clone = invoice.cloneNode(true);
      clone.id = "invoice_pdf_clone";
      clone.style.boxShadow = "none";
      clone.style.margin = "0";
      clone.style.position = "fixed";
      clone.style.left = "0";
      clone.style.top = "0";
      clone.style.zIndex = "99999";
      clone.style.background = "#fff";
      clone.querySelectorAll(".no-print").forEach(el => el.style.display = "none");

      const style = document.createElement("style");
      style.textContent = `
        #invoice_pdf_clone{
          width:210mm !important;
          min-height:297mm !important;
          height:auto !important;
          overflow:visible !important;
          box-shadow:none !important;
          border-radius:0 !important;
        }
      `;
      document.head.appendChild(style);
      document.body.appendChild(clone);

      await new Promise(r => setTimeout(r, 250));

      const opt = {
        margin: 0,
        filename: 'Facture_Delicella.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        pagebreak: { mode: ['avoid-all','css','legacy'] },
        html2canvas: {
          scale: 2,
          useCORS: true,
          backgroundColor: "#ffffff",
          scrollY: 0,
          windowWidth: clone.scrollWidth,
          windowHeight: clone.scrollHeight
        },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      try{
        await html2pdf().from(clone).set(opt).save();
      }catch(err){
        alert("Erreur: " + err);
      }finally{
        clone.remove();
        style.remove();
        btn.innerHTML = oldHTML;
        btn.disabled = false;
        window.scrollTo(0, oldScroll);
      }
    }

    /* ‚úÖ PRINT */
    function doPrint(){
      // ÿ±ÿ¨Ÿëÿπ ŸÑŸÅŸàŸÇ ÿ®ÿßÿ¥ ÿßŸÑÿ∑ÿ®ÿßÿπÿ© ÿ™ŸÉŸàŸÜ ŸÖÿ≥ÿ™ŸÇÿ±ÿ© ÿÆÿµŸàÿµÿßŸã iPhone
      window.scrollTo(0,0);
      setTimeout(() => window.print(), 120);
    }
  </script>
</body>
</html>
